include ../../../config.mak

CFLAGS=$(OPTFLAGS) -I. -I"$(SRC_PATH)/include"

#force configuration.h
#CFLAGS:=$(filter-out -DGPAC_HAVE_CONFIG_H,$(CFLAGS))
CFLAGS+=-DGPAC_MINIMAL_ODF -DGPAC_DISABLE_AV_PARSERS -DGPAC_DISABLE_ISOM_DUMP -DGPAC_DISABLE_ZLIB

ifeq ($(DEBUGBUILD), yes)
CFLAGS+=-g
LDFLAGS+=-g
endif

ifeq ($(GPROFBUILD), yes)
CFLAGS+=-pg
LDFLAGS+=-pg
endif

LINKFLAGS=-lpthread -ldl

FMP4_SRC=../../../src/utils/os_config_init.c ../../../src/utils/os_divers.c ../../../src/utils/os_thread.c ../../../src/utils/alloc.c ../../../src/utils/bitstream.c ../../../src/utils/configfile.c ../../../src/odf/desc_private.c ../../../src/odf/descriptors.c ../../../src/utils/error.c ../../../src/utils/list.c ../../../src/odf/odf_code.c ../../../src/odf/odf_codec.c ../../../src/odf/odf_command.c ../../../src/odf/odf_parse.c ../../../src/odf/slc.c ../../../src/utils/url.c ../../../src/media_tools/webvtt.c ../../../src/isomedia/avc_ext.c ../../../src/isomedia/box_code_3gpp.c ../../../src/isomedia/box_code_adobe.c ../../../src/isomedia/box_code_apple.c ../../../src/isomedia/box_code_base.c ../../../src/isomedia/box_code_drm.c ../../../src/isomedia/box_code_meta.c ../../../src/isomedia/box_funcs.c ../../../src/isomedia/data_map.c ../../../src/isomedia/drm_sample.c ../../../src/isomedia/isom_intern.c ../../../src/isomedia/isom_read.c ../../../src/isomedia/isom_store.c ../../../src/isomedia/isom_write.c ../../../src/isomedia/media.c ../../../src/isomedia/media_odf.c ../../../src/isomedia/meta.c ../../../src/isomedia/movie_fragments.c ../../../src/isomedia/sample_descs.c ../../../src/isomedia/stbl_read.c ../../../src/isomedia/stbl_write.c ../../../src/isomedia/track.c ../../../src/isomedia/tx3g.c

FMP4_OBJS := $(patsubst ../../../src/%.c,objs/%.o,$(FMP4_SRC)) 

all: $(FMP4_OBJS) main.o fmp4demux

clean:
	rm -rf $(FMP4_OBJS) objs/main.o

objs/%.o: ../../../src/%.c
	$(CC) $(CFLAGS) -c $< -o $@

objs/main.o: main.c
	$(CC) $(CFLAGS) -c $< -o $@

fmp4demux: $(FMP4_OBJS)
	$(CC) $(LDFLAGS) -o ../../../bin/gcc/$@ $(FMP4_OBJS) main.o $(LDFLAGS) $(LINKFLAGS)


